{% extends 'hms/base.html' %}
{% block content %}
<div class="container my-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-primary">
      <i class="fas fa-calendar-alt me-2"></i>All Appointments
    </h2>
    <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-primary">
      <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
    </a>
  </div>

  <div class="card border-0 shadow-lg">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="bg-primary text-white">
            <tr>
              <th>ID</th>
              <th>Patient</th>
              <th>Doctor</th>
              <th>Date</th>
              <th>Time</th>
              <th>Status</th>
              <th>Symptoms</th>
              <th>Diagnosis</th>
            </tr>
          </thead>
          <tbody>
            {% if appointments %}
              {% for appointment in appointments %}
              <tr>
                <td><strong>#{{ appointment.id }}</strong></td>
                <td>
                  <i class="fas fa-user-injured me-1 text-primary"></i>
                  {{ appointment.patient.name }}
                </td>
                <td>
                  <i class="fas fa-user-md me-1 text-success"></i>
                  {{ appointment.doctor.name }}
                  <br>
                  <small class="text-muted">{{ appointment.doctor.specialization }}</small>
                </td>
                <td>
                  <i class="fas fa-calendar me-1"></i>
                  {{ appointment.date }}
                </td>
                <td>
                  <i class="fas fa-clock me-1"></i>
                  {{ appointment.time }}
                </td>
                <td>
                  {% if appointment.status == 'Completed' %}
                    <span class="badge bg-success">
                      <i class="fas fa-check-circle me-1"></i>Completed
                    </span>
                  {% elif appointment.status == 'Booked' %}
                    <span class="badge bg-primary">
                      <i class="fas fa-calendar-check me-1"></i>Booked
                    </span>
                  {% else %}
                    <span class="badge bg-danger">
                      <i class="fas fa-times-circle me-1"></i>Cancelled
                    </span>
                  {% endif %}
                </td>
                <td>
                  {% if appointment.symptoms %}
                    <small>{{ appointment.symptoms[:50] }}{% if appointment.symptoms|length > 50 %}...{% endif %}</small>
                  {% else %}
                    <small class="text-muted">-</small>
                  {% endif %}
                </td>
                <td>
                  {% if appointment.diagnosis %}
                    <small>{{ appointment.diagnosis[:50] }}{% if appointment.diagnosis|length > 50 %}...{% endif %}</small>
                  {% else %}
                    <small class="text-muted">-</small>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="8" class="text-center py-5">
                  <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                  <p class="text-muted">No appointments found</p>
                </td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Summary Cards -->
  <div class="row mt-4">
    <div class="col-md-4">
      <div class="card border-0 shadow-sm bg-primary bg-opacity-10">
        <div class="card-body text-center">
          <i class="fas fa-calendar-check fa-2x text-primary mb-2"></i>
          <h3 class="fw-bold text-primary">{{ appointments|selectattr('status', 'equalto', 'Booked')|list|length }}</h3>
          <p class="text-muted mb-0">Booked Appointments</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card border-0 shadow-sm bg-success bg-opacity-10">
        <div class="card-body text-center">
          <i class="fas fa-check-circle fa-2x text-success mb-2"></i>
          <h3 class="fw-bold text-success">{{ appointments|selectattr('status', 'equalto', 'Completed')|list|length }}</h3>
          <p class="text-muted mb-0">Completed</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card border-0 shadow-sm bg-danger bg-opacity-10">
        <div class="card-body text-center">
          <i class="fas fa-times-circle fa-2x text-danger mb-2"></i>
          <h3 class="fw-bold text-danger">{{ appointments|selectattr('status', 'equalto', 'Cancelled')|list|length }}</h3>
          <p class="text-muted mb-0">Cancelled</p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
